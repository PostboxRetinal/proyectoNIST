# ProyectoNIST

Proyecto de microservicios backend construido con ElysiaJS y Bun, usando Firebase como backend NoSQL.

[![Unit Tests](https://github.com/PostboxRetinal/proyectoNIST/actions/workflows/unit-tests.yml/badge.svg)](https://github.com/PostboxRetinal/proyectoNIST/actions/workflows/unit-tests.yml)
[![Coverage Report](https://github.com/PostboxRetinal/proyectoNIST/actions/workflows/coverage-report.yml/badge.svg)](https://github.com/PostboxRetinal/proyectoNIST/actions/workflows/coverage-report.yml)

## ğŸ¯ **Estado del Proyecto**

- âœ… **Pruebas Unitarias**: Todos los servicios tienen cobertura completa de pruebas
- âœ… **Pipeline CI/CD**: Testing automatizado y reportes de cobertura
- âœ… **Mocking de Firebase**: Pruebas aisladas sin dependencias externas
- âœ… **Reportes de Cobertura**: GeneraciÃ³n automÃ¡tica y despliegue en GitHub Pages
- âœ… **Arquitectura Multi-Servicio**: Servicios de Company, Forms y User

## ğŸ“Š Reportes de Cobertura

Los reportes de cobertura de pruebas estÃ¡n disponibles en: [**Dashboard de Cobertura**](https://postboxretinal.github.io/proyectoNIST/coverage/)

- [Cobertura del Servicio Company](https://postboxretinal.github.io/proyectoNIST/coverage/company-service/)
- [Cobertura del Servicio Forms](https://postboxretinal.github.io/proyectoNIST/coverage/forms-service/)
- [Cobertura del Servicio User](https://postboxretinal.github.io/proyectoNIST/coverage/user-service/)

## Arquitectura

- **api-gateway**: Puerta de entrada para todas las peticiones externas. Redirige y controla el acceso a los microservicios internos.
- **user-service**: Microservicio dedicado a la autenticaciÃ³n y gestiÃ³n de usuarios (registro, login, recuperaciÃ³n de contraseÃ±a, etc.) usando Firebase Auth y Firestore.
- **company-service**: Microservicio para gestionar la informaciÃ³n de empresas.
- **forms-service**: Microservicio para manejar los formularios y auditorÃ­as NIST.

Cada microservicio es independiente y se comunica a travÃ©s del API Gateway. El despliegue se realiza mediante Docker y Docker Compose.

## TecnologÃ­as principales

- [Bun](https://bun.sh/) (runtime ultrarrÃ¡pido para JavaScript/TypeScript)
- [ElysiaJS](https://elysiajs.com/) (framework web para Bun)
- [Firebase](https://firebase.google.com/) (Auth y Firestore)
- [Swagger/OpenAPI](https://swagger.io/) (documentaciÃ³n interactiva de la API)
- [Docker](https://www.docker.com/) y [Docker Compose](https://docs.docker.com/compose/)
- [Vitest](https://vitest.dev/) (framework de testing para Bun/Node.js)
- [Elysia Swagger Plugin](https://elysiajs.com/plugins/swagger) (generaciÃ³n automÃ¡tica de documentaciÃ³n)

## Pruebas (Testing)

El proyecto incluye un sistema de testing robusto con CI/CD automatizado:

### ğŸ§ª **Ejecutar Pruebas Localmente**

```bash
# Ejecutar pruebas en un servicio especÃ­fico
cd services/company-service
bun test

# Ejecutar pruebas con cobertura
bun run test:coverage

# Ejecutar todas las pruebas en modo watch
bun test --watch
```

### ğŸ”„ **Pipeline CI/CD**

- **Pruebas automÃ¡ticas**: Se ejecutan en cada push y pull request
- **Cobertura**: Se genera automÃ¡ticamente y se publica en GitHub Pages
- **MÃºltiples servicios**: company-service, forms-service, user-service
- **Mocking de Firebase**: Pruebas aisladas sin dependencias externas

## Requisitos previos

- [Bun](https://bun.sh/) (Ãºltima versiÃ³n)
- [Docker](https://www.docker.com/) / [Docker Compose](https://docs.docker.com/compose/) / [Podman](https://podman.io/)

## InstalaciÃ³n y ejecuciÃ³n

1. Clona el repositorio:

   ```bash
   git clone https://github.com/PostboxRetinal/proyectoNIST.git
   cd proyectoNIST
   ```

2. Crea los archivos `.env` necesarios en cada microservicio

3. Instala y ejecuta docker para levantar el stack completo del proyecto

   ```bash
   docker-compose up --build
   ```

## ğŸ“‹ **DocumentaciÃ³n API con Swagger**

### **ğŸŒ Acceso a travÃ©s del API Gateway (Recomendado)**

El API Gateway con nginx redirige automÃ¡ticamente las peticiones a los servicios correspondientes:

### **ğŸ¯ Servicios y sus Endpoints**

**User Service** (acceso via `/api/users/`):

- GestiÃ³n de usuarios, autenticaciÃ³n, roles
- Swagger: `http://localhost:3001/api/users`

**Company Service** (acceso via `/api/companies/`):

- GestiÃ³n de empresas y organizaciones  
- Swagger: `http://localhost:3001/api/companies`

**Forms Service** (acceso via `/api/forms/`):

- Formularios y auditorÃ­as NIST
- Swagger: `http://localhost:3001/api/forms`

> **ğŸ’¡ Nota**: Todos los endpoints estÃ¡n disponibles a travÃ©s del API Gateway en `http://localhost:3001`. Las rutas internas de los servicios (puerto 4001, 4002, 4003) son para desarrollo directo.

### ğŸš€ **CÃ³mo consultar documentaciÃ³n Swagger**

1. **Inicia los servicios**:

   ```bash
   docker-compose up --build
   ```

2. **Accede a la documentaciÃ³n a travÃ©s del API Gateway**:

   - **User Service**: `http://localhost:3000/api/docs/user`
   - **Company Service**: `http://localhost:3000/api/docs/company`
   - **Forms Service**: `http://localhost:3000/api/docs/forms`

3. **Explora y prueba los endpoints**:

   - Navega por los endpoints disponibles
   - Prueba las peticiones directamente desde la interfaz
   - Visualiza los modelos de datos requeridos

## Scripts Ãºtiles

### ğŸ—ï¸ **Desarrollo**

- `bun run dev` â€” Inicia el servicio en modo desarrollo con recarga automÃ¡tica
- `docker-compose up --build` â€” Levanta todos los servicios con Docker

### ğŸ§ª **Pruebas**

- `bun test` â€” Ejecuta todas las pruebas
- `bun run test:coverage` â€” Ejecuta pruebas con reporte de cobertura
- `bun test --watch` â€” Ejecuta pruebas en modo watch
- `bun test --ui` â€” Abre la interfaz web de Vitest

## ğŸš€ **Workflows de CI/CD**

- **Pruebas Unitarias**: `.github/workflows/unit-tests.yml` - Ejecuta pruebas en cada push
- **Reporte de Cobertura**: `.github/workflows/coverage-report.yml` - Genera y publica reportes de cobertura

## ğŸ› ï¸ **ImplementaciÃ³n TÃ©cnica**

### **Estrategia de Mocking de Firebase**

- **Mocks Globales**: Configurados en `tests/setup.ts` para cada servicio
- **Aislamiento de Pruebas**: Cada prueba se ejecuta en un entorno aislado
- **Sin Dependencias Externas**: Las pruebas no requieren conexiÃ³n a Firebase real

### **IntegraciÃ³n Continua**

- **Testing Multi-Servicio**: Pruebas paralelas para cada microservicio
- **GestiÃ³n de Artefactos**: Cobertura almacenada y combinada automÃ¡ticamente
- **Despliegue en GitHub Pages**: Reportes publicados automÃ¡ticamente

---

Desarrollado con â¤ï¸ usando Bun, ElysiaJS y Firebase.
